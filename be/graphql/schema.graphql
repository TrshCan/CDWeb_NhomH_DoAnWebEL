# --------------------------------------------
# ----------------Scalars---------------------
# --------------------------------------------
scalar DateTime
scalar JSON

# --------------------------------------------
# ----------------Category--------------------
# --------------------------------------------
type Category {
    id: Int!
    name: String
    created_at: DateTime
    updated_at: DateTime
    deleted_at: DateTime
    surveys: [Survey!]
}

input CreateCategoryInput {
    id: Int!
    name: String
}

input UpdateCategoryInput {
    name: String
}

# --------------------------------------------
# ----------------Survey----------------------
# --------------------------------------------
type Survey {
    id: ID!
    title: String!
    description: String
    welcome_title: String
    welcome_description: String
    end_title: String
    end_description: String
    categories_id: Int!
    category: Category
    type: SurveyType!
    object: SurveyObject!
    status: SurveyStatus!
    created_by: ID!
    creator: User
    questions: [SurveyQuestion!]
    created_at: DateTime
    updated_at: DateTime
}

enum SurveyType {
    survey
    quiz
}

enum SurveyObject {
    public
    students
    lecturers
}

enum SurveyStatus {
    pending
    active
    paused
    closed
}

input CreateSurveyInput {
    title: String!
    description: String
    welcome_title: String
    welcome_description: String
    end_title: String
    end_description: String
    categories_id: Int!
    type: SurveyType
    object: SurveyObject
    status: SurveyStatus
    start_at: DateTime
    end_at: DateTime
}

input UpdateSurveyInput {
    title: String
    description: String
    welcome_title: String
    welcome_description: String
    end_title: String
    end_description: String
    categories_id: Int
    type: SurveyType
    object: SurveyObject
    status: SurveyStatus
    start_at: DateTime
    end_at: DateTime
}

# --------------------------------------------
# ----------------SurveyQuestion--------------
# --------------------------------------------
type SurveyQuestion {
    id: ID!
    survey_id: ID!
    survey: Survey
    question_code: String
    question_text: String!
    image: String
    question_type: String!
    required: QuestionRequired!
    conditions: JSON
    default_scenario: Int
    max_length: Int
    numeric_only: Boolean
    max_questions: Int
    allowed_file_types: String
    max_file_size_kb: Int
    help_text: String
    points: Int!
    options: [SurveyOption!]
}

enum QuestionRequired {
    none
    soft
    hard
}

input CreateQuestionInput {
    survey_id: ID!
    question_code: String
    question_text: String!
    image: String
    question_type: String!
    required: QuestionRequired
    conditions: JSON
    default_scenario: Int
    max_length: Int
    numeric_only: Boolean
    max_questions: Int
    allowed_file_types: String
    max_file_size_kb: Int
    help_text: String
    points: Int
}

input UpdateQuestionInput {
    question_code: String
    question_text: String
    image: String
    question_type: String
    required: QuestionRequired
    conditions: JSON
    default_scenario: Int
    max_length: Int
    numeric_only: Boolean
    max_questions: Int
    allowed_file_types: String
    max_file_size_kb: Int
    help_text: String
    points: Int
}

input CreateOptionInput {
    question_id: ID!
    option_text: String
    image: String
    is_subquestion: Boolean
    position: Int
    is_correct: Boolean
}

input UpdateOptionInput {
    option_text: String
    image: String
    is_subquestion: Boolean
    position: Int
    is_correct: Boolean
}

# --------------------------------------------
# ----------------SurveyOption----------------
# --------------------------------------------
type SurveyOption {
    id: ID!
    question_id: ID!
    question: SurveyQuestion
    option_text: String!
    image: String
    is_subquestion: Boolean!
    position: Int
    is_correct: Boolean!
}

# --------------------------------------------
# ----------------User (Basic)----------------
# --------------------------------------------
type User {
    id: ID!
    name: String!
    email: String!
}

# --------------------------------------------
# ----------------Queries---------------------
# --------------------------------------------
type Query {
    # Categories
    categories: [Category!]!
        @field(resolver: "App\\GraphQL\\Resolvers\\CategoryResolver@list")

    # Surveys
    surveys: [Survey!]!
        @field(resolver: "App\\GraphQL\\Resolvers\\SurveyResolver@list")

    survey(id: ID!): Survey
        @field(resolver: "App\\GraphQL\\Resolvers\\SurveyResolver@find")

    # Questions
    question(id: ID!): SurveyQuestion
        @field(resolver: "App\\GraphQL\\Resolvers\\QuestionResolver@find")
}

# --------------------------------------------
# ----------------Mutations-------------------
# --------------------------------------------
type Mutation {
    # Categories
    createCategory(input: CreateCategoryInput!): Category
        @field(resolver: "App\\GraphQL\\Resolvers\\CategoryResolver@create")

    updateCategory(id: Int!, input: UpdateCategoryInput!): Category
        @field(resolver: "App\\GraphQL\\Resolvers\\CategoryResolver@update")

    deleteCategory(id: Int!, allowIfReferenced: Boolean): Boolean!
        @field(resolver: "App\\GraphQL\\Resolvers\\CategoryResolver@delete")

    # Surveys
    createSurvey(input: CreateSurveyInput!): Survey
        @field(resolver: "App\\GraphQL\\Resolvers\\SurveyResolver@create")
    
    updateSurvey(id: ID!, input: UpdateSurveyInput!): Survey
        @field(resolver: "App\\GraphQL\\Resolvers\\SurveyResolver@update")

    # Questions
    addQuestion(input: CreateQuestionInput!): SurveyQuestion
        @field(resolver: "App\\GraphQL\\Resolvers\\QuestionResolver@create")
    
    updateQuestion(id: ID!, input: UpdateQuestionInput!): SurveyQuestion
        @field(resolver: "App\\GraphQL\\Resolvers\\QuestionResolver@update")
    
    addOption(input: CreateOptionInput!): SurveyOption
        @field(resolver: "App\\GraphQL\\Resolvers\\QuestionResolver@createOption")
    
    updateOption(id: ID!, input: UpdateOptionInput!): SurveyOption
        @field(resolver: "App\\GraphQL\\Resolvers\\QuestionResolver@updateOption")
    
    deleteOption(id: ID!): Boolean!
        @field(resolver: "App\\GraphQL\\Resolvers\\QuestionResolver@deleteOption")
    
    deleteQuestion(id: ID!): Boolean!
        @field(resolver: "App\\GraphQL\\Resolvers\\QuestionResolver@delete")
    
    deleteQuestions(ids: [ID!]!): Boolean!
        @field(resolver: "App\\GraphQL\\Resolvers\\QuestionResolver@deleteBatch")
}
